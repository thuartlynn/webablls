<?php
    $Faker_Table = array( 0=>array( 0=>array("Notes"=>"Note First",
                                             "Edit"=>"#00ff00",
                                             "Score"=>array(0=>"red",
                                                            1=>"0")),
                                    1=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            2=>"#00ff00")),
                                    2=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                    3=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00")),
                                    4=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                    5=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                    6=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00")),
                                    7=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00")),
                                    8=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00")),
                                    9=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00")),
                                   10=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00")),
                                   11=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00")),
                                   12=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                   13=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                   14=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00")),
                                   15=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                   16=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                   17=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00")),
                                   18=>array("Notes"=>"Note Last",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00"))
                                  ),
                          1=>array( 0=>array("Notes"=>"Note 12",
                                             "Edit"=>"#00ff00",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                    1=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                    2=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                    3=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00")),
                                    4=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                    5=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00")),
                                    6=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00")),
                                    7=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                    8=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                    9=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                   10=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                   11=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                   12=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                   13=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                   14=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                   15=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                   16=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                   17=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                   18=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                   19=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                   20=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                   21=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                   22=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00")),
                                   23=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00")),
                                   24=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                   25=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00",
                                                            2=>"#00ff00",
                                                            3=>"#00ff00")),
                                   26=>array("Notes"=>"Note",
                                             "Edit"=>"0",
                                             "Score"=>array(0=>"#00ff00",
                                                            1=>"#00ff00"))
                                  ),
                        );
?>

<div class="margin-top20", style="margin-top: 20px;">
  <div class="tgv-nav">
    <div class="left ina"><< previous page</div>
    <div class="right">next page >></div>
  </div>
</div>
<?php
  include('/web/resources/views/contents/app_webablls_assessment_category_table.blade.php');

  $tvgtitle_table = [];
  $color = "#00ff00";

  foreach (array_keys($Category_Table[0]) as $temp) {
    $tvgtitle_table[] = $temp;
  }

  $page_total_item = 9;
  $total_page_num = 1;

  if ((sizeof($tvgtitle_table) % $page_total_item) != 0) {
      $total_page_num = (int)(sizeof($tvgtitle_table) / $page_total_item) + 1;
  } else {
      $total_page_num = (int)(sizeof($tvgtitle_table) / $page_total_item);
  }

  if ($page_id == 1) {
    echo '<div class="tgv main">'; // total tvg
  } else {
    echo '<div class="tgv edit">'; // Edit
  }

  for ($page_count = 1; $page_count <= $total_page_num; $page_count++) {
    if ($page_count == 1) {
        echo '<div class="tgv-page" id="tgv-page-'.$page_count.'">';
    } else {
        echo '<div class="tgv-page hidden" id="tgv-page-'.$page_count.'">';
    }

    echo '<div class="h">';
    foreach (range(($page_count-1) * $page_total_item, ($page_count * $page_total_item) - 1) as $number) {
      if ($number >= sizeof($Category_Table[0])) {
        break;
      }
      echo '<div class="sh">'.$Category_Table[0][$tvgtitle_table[$number]][0]["Title2"].'</div>';
    }
    echo '</div>';

    foreach (range(($page_count-1) * $page_total_item, ($page_count * $page_total_item) - 1) as $number) {
      if ($number >= sizeof($Faker_Table)) {
        break;
      }
      echo '<div class="tgv-category">';
      $item_count = 0;
      foreach (array_reverse($Faker_Table[$number]) as $value) {

        $item_temp = sizeof($Faker_Table[$number]) - $item_count;
        $index_temp = $tvgtitle_table[$number].($item_temp);
        echo '<div class="w" id="task-'.$index_temp.'">';
        if ($value["Notes"] != "") {
            echo '<div title= "'.$Category_Table[0][$tvgtitle_table[$number]][0][$index_temp][0]["Title"].'"class="l no">'.$tvgtitle_table[$number].''.$item_temp.'</div>';
        } else {
            echo '<div title= "'.$Category_Table[0][$tvgtitle_table[$number]][0][$index_temp][0]["Title"].'"class="l">'.$tvgtitle_table[$number].''.$item_temp.'</div>';
        }

        if ($Faker_Table[$number][$item_temp-1]["Edit"] == "0") {
            if ($page_id == 1) {
                echo '<div class="b"> </div>'; // total tvg
            } else if ($page_id == 2) {
                echo '<div class="b"> </div>'; // Edit, First create
            } else {
                echo '<div class="b bl"> </div>'; // Edit, Other
            }
        } else {
            if ($page_id == 1) {
                echo '<div class="b s" style="background-color: '.$Faker_Table[$number][$item_temp-1]["Edit"].';"> </div>'; // total tvg
            } else if ($page_id == 2) {
                echo '<div class="b se" style="background-color: '.$Faker_Table[$number][$item_temp-1]["Edit"].';"> </div>'; // Edit, First create
            } else {
                echo '<div class="b p bl" style="background-color: '.$Faker_Table[$number][$item_temp-1]["Edit"].';"> </div>'; // Edit, Other
            }
        }

        echo '<div class="r">';
        $select_count = sizeof($Faker_Table[$number][$item_temp-1]["Score"]);
        foreach (array_reverse($Faker_Table[$number][$item_temp-1]["Score"]) as $score) {
            if ($score == $color) {
                break;
            }
            $select_count--;
        }

        if (sizeof($Faker_Table[$number][$item_temp-1]["Score"]) == 4) {
            $border = "q";
        } else if (sizeof($Faker_Table[$number][$item_temp-1]["Score"]) == 2) {
            $border = "d";
        } else {
            $border = "s";
        }

        
        echo '</div>';
        echo '<div class="c"> </div>';
        echo '</div>';
        $item_count++;
      }
      echo '</div>';
    }

    echo '<div class="h">';
    foreach (range(($page_count-1) * $page_total_item, ($page_count * $page_total_item) - 1) as $number) {
      if ($number == sizeof($tvgtitle_table)) {
        break;
      }
      echo '<div class="sh">'.$Category_Table[0][$tvgtitle_table[$number]][0]["Title2"].'</div>';
    }
    echo '</div>';
    echo '</div>';
  }
  echo '</div>';
?>

<div class="tgv-nav">
  <div class="left ina"><< previous page</div>
  <div class="right">next page >></div>
</div>

<?php
// For Test
include('/web/resources/views/contents/app_webablls_assessment_task_infobox.blade.php');
// For Test
?>

<script>
  var color = "<?php echo $color?>";
  var changes = false;

  function cancel() {
    window.location.reload();
  }

  $().save({
    saveCallback: save,
    cancelCallback: cancel,
    Warnign: 'There are unsaved changes. Be sure to save them before you leave this page. All unsaved changes will be lost.',
    Save: 'Save',
    Cancel: 'Cancel',
    Confirm: 'Changes have been saved'
  });

  function save() {
    if (!changes) return;
    actual_save();
  }

  // For Test
  function test() {
    $(".w").each(function() {
      if ($(this).hasClass("selected")) {
        console.log($(this).attr("id"));
      }
    });
  }

  $(function() {
    $("#task-infobox").dialog({
      autoOpen: false,
      width: 600,
      height: 500,
      maxHeight: 1000,
      modal: true,
      close: function () {
        $(".taskpopupMarker").removeClass("taskpopupMarker");
      },
      overlay: {
        opacity: 0.5,
        background: "black"
      },
      draggable: false,
      resizable: false,
      title: "Task Info Box"
    });
  });
  // For Test
    
  //var tbLock = false;
  $(".w .l").on("click", function () {
    // For Test
    $( "#task-infobox" ).dialog( "open" );
    // For Test
    //if (tbLock) return;
    //tbLock = true;
    var code = $(this).html().toString();
    $(this).addClass("taskpopupMarker");
    var Url = "{{url('Assessment/TgvGridEdit/6840')}}" + "/" + code;
    $.ajax({
      type: 'GET',
      cache: false,
      headers: {
        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
      },
      url: Url,
      success: function (data) {
        $("body").append(data);
        $("#task-infobox").dialog({
          width: 600,
          height: 500,
          maxHeight: 1000,
          modal: true,
          close: function () {
            $("#task-infobox").remove();
            //tbLock = false;
            $(".taskpopupMarker").removeClass("taskpopupMarker");
          },
          overlay: {
            opacity: 0.5,
            background: "black"
          },
          draggable: false,
          resizable: false,
          title: "Task Info Box"
        });
      },
    });
  });
</script>