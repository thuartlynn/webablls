<?php

    $AnalysisDetails = array( 0=>array("Assigned_Date"=>"11/04/2019",
                                       "Assessment_Date"=>"11/03/2019",
                                       "Assessments"=>array(0=>array("Color"=>"#00bfff",
                                                                     "Text"=>"Assessment 11/03/2019 (age 2 years, 11 months)")),
                                       "Normative_Data"=>"2 years",
                                       "Output_Options"=>"Table analysis of single assesment",
                                       "Graphs_with_Total_Items_Scale"=>array(0=>"Include Section Graphs",
                                                                              1=>"Include Categories Graphs"),
                                       "Graphs_with_Total_Scores_Scale"=>array(0=>"Include Section Graphs",
                                                                               1=>"Include Categories Graphs"),
                                       "Graphs_with_Percentage_Scale"=>array(0=>"Include Section Graphs",
                                                                             1=> "Include Categories Graphs"),
                                       "Section_Analysis"=>array(0=>"Basic Language and Learner Skills Section (A-P)",
                                                                 1=>"Language Skills (C,E,F,G,H,I,J)",
                                                                 2=>"Academic Skills Section (Q-T)",
                                                                 3=>"Self-Help Skills Section (U-X)",
                                                                 4=>"Motor Skill Section (Y-Z)",
                                                                 5=>"Total ABLLS-R (A-Z)"),
                                       "Category_Analysis"=>array(  0=>"A. Cooperation and Reinfocer Effectiveness",
                                                                    1=>"B. Visual Performance",
                                                                    2=>"C. Receptive Language",
                                                                    3=>"D. Motor lmitation",
                                                                    4=>"E. Vocal lmitation",
                                                                    5=>"F. Requests",
                                                                    6=>"G. Labeling",
                                                                    7=>"H. Intraverbals",
                                                                    8=>"I. Spontaneous Vocalizations",
                                                                    9=>"J. Syntax and Grammar",
                                                                   10=>"K. Play and Leisure Skills",
                                                                   11=>"L. Social Interactions",
                                                                   12=>"M. Group Instruction",
                                                                   13=>"N. Follow Classroom Routines",
                                                                   14=>"P. Generalized Responding",
                                                                   15=>"Q. Reading Skills",
                                                                   16=>"R. Math Skills",
                                                                   17=>"S. Writing Skills",
                                                                   18=>"T. Spelling",
                                                                   19=>"U. Dressing Skills",
                                                                   20=>"V. Eating Skills",
                                                                   21=>"W. Grooming Skills",
                                                                   22=>"X. Toileting Skills",
                                                                   23=>"Y. Gross Motor Skills",
                                                                   24=>"Z. Fine Motor Skills")
                                       ));
    $Chart = array( 0=>array("ID"=>"Chart0",
                             "Title"=>"A. Cooperation and Reinfocer Effectiveness",
                             "Value"=>array(0=>"100",
                                            1=>"70"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     1=>array("ID"=>"Chart1",
                             "Title"=>"B. Visual Performance",
                             "Value"=>array(0=>"120",
                                            1=>"40"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     2=>array("ID"=>"Chart2",
                             "Title"=>"C. Receptive Language",
                             "Value"=>array(0=>"50",
                                            1=>"10"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     3=>array("ID"=>"Chart3",
                             "Title"=>"D. Motor lmitation",
                             "Value"=>array(0=>"50",
                                            1=>"10"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     4=>array("ID"=>"Chart4",
                             "Title"=>"E. Vocal lmitation",
                             "Value"=>array(0=>"120",
                                            1=>"40"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     5=>array("ID"=>"Chart5",
                             "Title"=>"F. Requests",
                             "Value"=>array(0=>"50",
                                            1=>"10"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     6=>array("ID"=>"Chart6",
                             "Title"=>"G. Labeling",
                             "Value"=>array(0=>"50",
                                            1=>"10"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     7=>array("ID"=>"Chart7",
                             "Title"=>"H. Intraverbals",
                             "Value"=>array(0=>"120",
                                            1=>"40"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     8=>array("ID"=>"Chart8",
                             "Title"=>"I. Spontaneous Vocalizations",
                             "Value"=>array(0=>"50",
                                            1=>"10"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     9=>array("ID"=>"Chart9",
                             "Title"=>"J. Syntax and Grammar",
                             "Value"=>array(0=>"50",
                                            1=>"10"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     10=>array("ID"=>"Chart10",
                             "Title"=>"K. Play and Leisure Skills",
                             "Value"=>array(0=>"120",
                                            1=>"40"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     11=>array("ID"=>"Chart11",
                             "Title"=>"L. Social Interactions",
                             "Value"=>array(0=>"50",
                                            1=>"10"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     12=>array("ID"=>"Chart12",
                             "Title"=>"M. Group Instruction",
                             "Value"=>array(0=>"50",
                                            1=>"10"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     13=>array("ID"=>"Chart13",
                             "Title"=>"N. Follow Classroom Routines",
                             "Value"=>array(0=>"120",
                                            1=>"40"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     14=>array("ID"=>"Chart14",
                             "Title"=>"P. Generalized Responding",
                             "Value"=>array(0=>"50",
                                            1=>"10"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     15=>array("ID"=>"Chart15",
                             "Title"=>"Q. Reading Skills",
                             "Value"=>array(0=>"50",
                                            1=>"10"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     16=>array("ID"=>"Chart16",
                             "Title"=>"R. Math Skills",
                             "Value"=>array(0=>"120",
                                            1=>"40"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     17=>array("ID"=>"Chart17",
                             "Title"=>"S. Writing Skills",
                             "Value"=>array(0=>"50",
                                            1=>"10"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     18=>array("ID"=>"Chart18",
                             "Title"=>"T. Spelling",
                             "Value"=>array(0=>"50",
                                            1=>"10"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     19=>array("ID"=>"Chart19",
                             "Title"=>"U. Dressing Skills",
                             "Value"=>array(0=>"120",
                                            1=>"40"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     20=>array("ID"=>"Chart20",
                             "Title"=>"V. Eating Skills",
                             "Value"=>array(0=>"50",
                                            1=>"10"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     21=>array("ID"=>"Chart21",
                             "Title"=>"W. Grooming Skills",
                             "Value"=>array(0=>"50",
                                            1=>"10"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     22=>array("ID"=>"Chart22",
                             "Title"=>"X. Toileting Skills",
                             "Value"=>array(0=>"50",
                                            1=>"10"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     23=>array("ID"=>"Chart23",
                             "Title"=>"Y. Gross Motor Skills",
                             "Value"=>array(0=>"50",
                                            1=>"10"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100")),
                     24=>array("ID"=>"Chart24",
                             "Title"=>"Z. Fine Motor Skills",
                             "Value"=>array(0=>"50",
                                            1=>"10"),
                             "Total_Value"=>array(0=>"150",
                                                  1=>"100"))
                  );
?>

<p style="margin: 0 0 10px 0; padding: 0;" class="mt-3 app-right-bottom-h1">Category Graphs with Percentage Scale</p>

<div class="container mt-3 mb-3 app-right-bottom-mr">
  <div class="row align-items-center">
  <span style="padding: 0 0 0 10px; border: 1px solid gray;">
    <p style="display: inline-block; width: 50px; height: 10px; border: 1px solid black; margin: 0; background-color: rgba(119, 247, 119, 0.5);"></p>
    <p style="display: inline; margin: 0 10px 0  0; padding: 0;" class="app-right-bottom-content"><?php echo $AnalysisDetails[0]["Assessment_Date"] ?></p>
    <p style="display: inline-block; width: 50px; height: 10px; border: 1px solid black; margin: 0; background-color: rgba(154, 145, 138, 0.5);"></p>
    <p style="display: inline; margin: 0 10px 0  0; padding: 0;" class="app-right-bottom-content">normative data (<?php echo $AnalysisDetails[0]["Normative_Data"] ?>)</p>
  </span>
  </div>
</div>
<div class="container-fluid">
<?php
    $count = 0;
    echo '<div class="row mt-3">';
    foreach ($Chart as $value) {

      echo '<div style="margin: 0; padding: 0;" class="col-md-4">';
        
            echo '<div style="-moz-margin-end : 20px; vertical-align: top; display: -moz-inline-stack; display: inline-block; align-text: center;">';
              echo '<p class="app-right-bottom-h1-2" style="font-size: 8pt; filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=2); -moz-transform: rotate(180deg); -o-transform: rotate(180deg); -webkit-transform: rotate(180deg); transform: rotate(180deg); padding: 0px; margin: 0 0 45px 0; -webkit-writing-mode: vertical-rl; writing-mode: vertical-rl;">Percent of Total Possible Socre</p>';
            echo '</div>';
            echo '<div style="vertical-align: top; display: -moz-inline-stack; display: inline-block; height:200px; width:200px;">';
              echo '<canvas id="'.$value["ID"].'"></canvas>';
            echo '</div>';
      echo '</div>';

      $count++;
    }
    echo '</div">';
?>
</div>

<script type="text/javascript">
    $(function () {

        // Font color for values inside the bar
        var insideFontColor = '255,255,255';
        // Font color for values above the bar
        var outsideFontColor = '0,0,0';
        // How close to the top edge bar can be before the value is put inside it
        var topThreshold = 60;
        var canvas = [];
        var data = [];
        var option = [];

        var modifyCtx = function(ctx) {
            ctx.font = Chart.helpers.fontString(Chart.defaults.global.defaultFontSize, 'normal', Chart.defaults.global.defaultFontFamily);
            ctx.textAlign = 'center';
            ctx.textBaseline = 'bottom';
            return ctx;
        };

        var fadeIn = function(ctx, obj, x, y, black, step) {
            var ctx = modifyCtx(ctx);
            var alpha = 0;
            ctx.fillStyle = black ? 'rgba(' + outsideFontColor + ',' + step + ')' : 'rgba(' + insideFontColor + ',' + step + ')';
            ctx.fillText(obj, x, y);
        };

        var drawValue = function(context, step) {
            var ctx = context.chart.ctx;

            for (var i = 0; i < context.data.datasets[0].data.length; i++) {
                var model = context.data.datasets[0]._meta[Object.keys(context.data.datasets[0]._meta)[0]].data[i]._model;
                var textY = (model.y > topThreshold) ? model.y - 3 : model.y + 20;
                fadeIn(ctx, context.data.datasets[0].data[i], model.x, textY, 1, step);
            }
        };

        var Value = <?php echo json_encode($Chart); ?>;
        var count = 0;
        Value.forEach(function(key){
          var data1 = [];
          var data2 = [];
          var label = [];
          var Colortmp1 = ["rgba(119, 247, 119, 0.5)", "rgba(154, 145, 138, 0.5)", "rgba(86, 104, 120, 0.5)"];
          var Colortmp2 = ["rgba(119, 247, 119, 1)", "rgba(154, 145, 138, 1)", "rgba(86, 104, 120, 1)"];
          var Color1 = [];
          var Color2 = [];

          for (var i = 0; i < key["Value"].length;i++) {
            data1.push(key["Total_Value"][i]);
            data2.push(key["Value"][i]);
            label.push('');
            Color1.push(Colortmp1[i]);
            Color2.push(Colortmp2[i]);
          }

          canvas[count] = document.getElementById(key["ID"]).getContext('2d');

          data[count] = {
            labels: label,
            datasets: [{
                data: data1,
                backgroundColor: Color1,
            },{
                data: data2,   
                backgroundColor: Color2,
            }]
          };

          option[count] = {
            responsive: true,
            maintainAspectRatio: false,
            title: {
                display: true,
                text: key["Title"],
                position: 'bottom'
            },
            hover: {
                animationDuration: 0,
                mode: null
            },
            legend: {
                display: false,
            },
            tooltips: {
                enabled: false,
            },
            animation: {
                onComplete: function() {
                    this.chart.controller.draw();
                    drawValue(this, 1);
                },
                onProgress: function(state) {
                    var animation = state.animationObject;
                    drawValue(this, animation.currentStep / animation.numSteps);
                }
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero:true
                    }
                }],
                xAxes: [{
                    id: "bar-x-axis1",
                    stacked: true,
                    display: false,
                    barPercentage: 0.9
                }, {
                    id: "bar-x-axis2",
                    stacked: true,
                    display: false,
                    barPercentage: 0.9
                }, 
            ]},
            plugins: {
                datalabels: {
                    anchor: 'end',
                    align: 'top'   
                }
            }
          };

          Chart.Bar(canvas[count], {
            data: data[count],
            options: option[count]
          });
          count++;
        });
    });
</script>